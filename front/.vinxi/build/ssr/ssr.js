import{ssrElement as y,escape as d,mergeProps as F,ssr as f,renderToStream as L,createComponent as u,ssrHydrationKey as m,isServer as N,getRequestEvent as k,useAssets as _,NoHydration as E,HydrationScript as I,ssrAttribute as B,Hydration as j}from"solid-js/web";import{lazy as P,createComponent as O,sharedConfig as S,createResource as W,createSignal as R,Suspense as K,For as z,onCleanup as D,ErrorBoundary as J}from"solid-js";import{provideRequestEvent as Q}from"solid-js/web/storage";import{getRequestURL as x,getRequestWebStream as U,getRequestIP as V,setResponseHeader as w,setResponseStatus as v,appendResponseHeader as Y,getResponseHeader as G,removeResponseHeader as X,getCookie as Z,setCookie as ee,eventHandler as te,sendRedirect as ne,setHeader as re}from"h3";function se(e){let r;const t=x(e),n={duplex:"half",method:e.method,headers:e.headers};return e.node.req.body instanceof ArrayBuffer?new Request(t,{...n,body:e.node.req.body}):new Request(t,{...n,get body(){return r||(r=U(e),r)}})}function oe(e){return e.web??={request:se(e),url:x(e)},e.web.request}const q=Symbol("h3Event"),g=Symbol("fetchEvent"),ae={get(e,r){return r===g?e:e[r]??e[q][r]}};function ie(e){const r=oe(e);return new Proxy({request:r,clientAddress:V(e),locals:{},[q]:e},ae)}function le(e){if(!e[g]){const r=ie(e);e[g]=r}return e[g]}function ce(e){e.forEach(r=>{if(!r.attrs.href)return;let t=document.head.querySelector(`link[href="${r.attrs.href}"]`);t||(t=document.createElement("link"),t.setAttribute("rel","preload"),t.setAttribute("as","style"),t.setAttribute("href",r.attrs.href),document.head.appendChild(t))})}var ue=" ";const de={style:e=>y("style",e.attrs,()=>d(e.children),!0),link:e=>y("link",e.attrs,void 0,!0),script:e=>e.attrs.src?y("script",F(()=>e.attrs,{get id(){return e.key}}),()=>f(ue),!0):null};function b(e){let{tag:r,attrs:{key:t,...n}={key:void 0},children:s}=e;return de[r]({attrs:n,key:t,children:s})}function fe(e,r,t,n="default"){return P(async()=>{{const o=(await e.import())[n],i=(await r.inputs?.[e.src].assets()).filter(c=>c.tag==="style"||c.attrs.rel==="stylesheet");return typeof window<"u"&&ce(i),{default:c=>[...i.map(h=>b(h)),O(o,c)]}}})}const A=[],he=ge(A.filter(e=>e.type==="page")),pe=ye(A.filter(e=>e.type==="api"));function me(e,r){const t=e.replace("","").split("/").filter(Boolean);e:for(const n of pe){const s=n.matchSegments;if(t.length<s.length||!n.wildcard&&t.length>s.length)continue;for(let i=0;i<s.length;i++){const l=s[i];if(l&&t[i]!==l)continue e}const o=n[`$${r}`];if(o==="skip"||o===void 0)return;const a={};for(const{type:i,name:l,index:c}of n.params)i===":"?a[l]=t[c]:a[l]=t.slice(c).join("/");return{handler:o,params:a}}}function ge(e){function r(t,n,s,o){const a=Object.values(t).find(i=>s.startsWith(i.id+"/"));return a?(r(a.children||(a.children=[]),n,s.slice(a.id.length)),t):(t.push({...n,id:s,path:s.replace(/\/\([^)/]+\)/g,"")}),t)}return e.sort((t,n)=>t.path.length-n.path.length).reduce((t,n)=>r(t,n,n.path,n.path),[])}function ye(e){return e.flatMap(r=>T(r.path).map(n=>({...r,path:n}))).map(we).sort((r,t)=>t.score-r.score)}function T(e){let r=/(\/?\:[^\/]+)\?/.exec(e);if(!r)return[e];let t=e.slice(0,r.index),n=e.slice(r.index+r[0].length);const s=[t,t+=r[1]];for(;r=/^(\/\:[^\/]+)\?/.exec(n);)s.push(t+=r[1]),n=n.slice(r[0].length);return T(n).reduce((o,a)=>[...o,...s.map(i=>i+a)],[])}function we(e){const r=e.path.split("/").filter(Boolean),t=[],n=[];let s=0,o=!1;for(const[a,i]of r.entries())if(i[0]===":"){const l=i.slice(1);s+=3,t.push({type:":",name:l,index:a}),n.push(null)}else i[0]==="*"?(s-=1,t.push({type:"*",name:i.slice(1),index:a}),o=!0):(s+=4,i.match(/^\(.+\)$/)||n.push(i));return{...e,score:s,params:t,matchSegments:n,wildcard:o}}function ve(){function e(t){return{...t,...t.$$route?t.$$route.require().route:void 0,metadata:{...t.$$route?t.$$route.require().route.metadata:{},filesystem:!0},component:fe(t.$component,globalThis.MANIFEST.client,globalThis.MANIFEST.ssr),children:t.children?t.children.map(e):void 0}}return he.map(e)}function be(e){const r=Z(e,"flash");if(!r)return;let t=JSON.parse(r);if(!t||!t.result)return[];const n=[...t.input.slice(0,-1),new Map(t.input[t.input.length-1])];return ee(e,"flash","",{maxAge:0}),{url:t.url,result:t.error?new Error(t.result):t.result,input:n}}async function M(e){const r=globalThis.MANIFEST.client;return globalThis.MANIFEST.ssr,w(e,"Content-Type","text/html"),Object.assign(e,{manifest:await r.json(),assets:[...await r.inputs[r.handler].assets()],initialSubmission:be(e),routes:ve(),components:{status:n=>(v(e,n.code,n.text),()=>v(e,200)),header:n=>(n.append?Y(e,n.name,n.value):w(e,n.name,n.value),()=>{const s=G(e,n.name);if(s&&typeof s=="string"){const o=s.split(", "),a=o.indexOf(n.value);a!==-1&&o.splice(a,1),o.length?w(e,n.name,o.join(", ")):X(e,n.name)}})},$islands:new Set})}function Se(e,r={}){return te({onRequest:r.onRequest,onBeforeResponse:r.onBeforeResponse,handler:t=>{const n=le(t);return Q(n,async()=>{const s=me(new URL(n.request.url).pathname,n.request.method);if(s){const p=(await s.handler.import())[n.request.method];return n.params=s.params,S.context={event:n},await p(n)}const o=await M(n);let a={...r};if(a.onCompleteAll){const h=a.onCompleteAll;a.onCompleteAll=p=>{C(o)(p),h(p)}}else a.onCompleteAll=C(o);if(a.onCompleteShell){const h=a.onCompleteShell;a.onCompleteShell=p=>{$(o,t)(),h(p)}}else a.onCompleteShell=$(o,t);const i=L(()=>(S.context.event=o,e(o)),a);if(o.response&&o.response.headers.get("Location"))return ne(n,o.response.headers.get("Location"));const{writable:l,readable:c}=new TransformStream;return i.pipeTo(l),c})}})}function $(e,r){return()=>{e.response&&e.response.headers.get("Location")&&(v(r,302),re(r,"Location",e.response.headers.get("Location")))}}function C(e){return({write:r})=>{const t=e.response&&e.response.headers.get("Location");t&&r(`<script>window.location="${t}"<\/script>`)}}function Re(e,r={}){return Se(e,{...r,createPageEvent:M})}var $e=["<main",'><div class="container mx-auto"><h1 class="text-pink-500">wen beefy?</h1><div class="flex justify-center"><input class="search-field w-7/10 px-4 mr-8 py-2 bg-gray-100 rounded-lg border-1 border-gray-300" type="text" placeholder="Search..."><button class="','">','</button></div><div class="table-container flex flex-col">',"</div></div></main>"],Ce=["<div",">Loading...</div>"],ke=["<div",' class="table-row flex flex-row p-4 m-4 bg-pink-300 bg-opacity-30 overflow-auto"><div>',"</div><div>","</div><div>","</div></div>"];async function Ee(){try{const e=await fetch("http://localhost:4000");if(!e.ok)throw new Error("Network response was not ok");return await e.json()}catch(e){return console.error("Failed to fetch data:",e),null}}function xe(){const[e,r]=W(Ee),[t,n]=R(!0),[s,o]=R(""),a=()=>{const i=t()?e()?.candidates1kv:e()?.candidatesnon1kv;if(!i)return[];const l=s().toLowerCase();return i.filter(c=>c.name?.toLowerCase().includes(l)||c.stash?.toLowerCase().includes(l)||typeof c.matrix=="string"&&c.matrix.toLowerCase().includes(l))};return u(K,{get fallback(){return f(Ce,m())},get children(){return f($e,m(),"w-2/10 toggle",t()?"1KV":"Non-1KV",d(u(z,{get each(){return a()},children:i=>f(ke,m(),d(i.name),d(i.stash)||d(i.address),d(i.matrix))})))}})}function qe(e){if(N){const r=k();r&&D(r.components.status(e))}return null}function Ae(e){return u(J,{get fallback(){return u(qe,{code:500})},get children(){return e.children}})}var Te=["<script",">","<\/script>"],Me=["<script",' type="module" async',"><\/script>"];const He=f("<!DOCTYPE html>");function H(e,r,t=[]){for(let n=0;n<r.length;n++){const s=r[n];if(s.path!==e[0].path)continue;let o=[...t,s];if(s.children){const a=e.slice(1);if(a.length===0||(o=H(a,s.children,o),!o))continue}return o}}function Fe(e){const r=k();let t=[];return Promise.resolve().then(async()=>{if(r.routerMatches&&r.routerMatches[0]){const n=[...r.routerMatches[0]];for(;n.length&&(!n[0].metadata||!n[0].metadata.filesystem);)n.shift();const s=n.length&&H(n,r.routes);if(s)for(let o=0;o<s.length;o++){const a=s[o],l=await globalThis.MANIFEST.client.inputs[a.$component.src].assets();t.push.apply(t,l)}else console.warn("No route matched for preloading js assets")}t=[...new Map(t.map(n=>[n.attrs.key,n])).values()].filter(n=>n.attrs.rel==="modulepreload"&&!r.assets.find(s=>s.attrs.key===n.attrs.key))}),_(()=>t.length?t.map(n=>b(n)):void 0),u(E,{get children(){return[He,u(e.document,{get assets(){return[u(I,{}),r.assets.map(n=>b(n))]},get scripts(){return[f(Te,m(),`window.manifest = ${JSON.stringify(r.manifest)}`),f(Me,m(),B("src",d(globalThis.MANIFEST.client.inputs[globalThis.MANIFEST.client.handler].output.path,!0),!1))]},get children(){return u(j,{get children(){return u(Ae,{get children(){return u(xe,{})}})}})}})]}})}var Le=['<head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.ico">',"</head>"],Ne=["<html",' lang="en">','<body><div id="app">',"</div><!--$-->","<!--/--></body></html>"];const Pe=Re(()=>u(Fe,{document:({assets:e,children:r,scripts:t})=>f(Ne,m(),u(E,{get children(){return f(Le,d(e))}}),d(r),d(t))}));export{Pe as default};
